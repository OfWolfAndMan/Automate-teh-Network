- hosts: rpi
  gather_facts: True
  
  tasks:
    - name: Update package cache
      package:
        update_cache: yes
    - name: Upgrade packages
      command: apt-get upgrade -y
    - name: Update all packages to latest version
      package:
        upgrade: dist
    - name: Remove dependencies no longer needed
      command: apt autoremove -y

- hosts: cumulus
  gather_facts: False
  remote_user: cumulus

  #vars:

  tasks:
    - name: Update package cache and upgrade packages
      command: apt-get update
      command: apt-get upgrade -y
      become: true
      #become_method: sudo
      become_user: root

    - name: Reboot server (Required for Cumulus after update)
      command: /sbin/shutdown -r +1
      async: 0
      poll: 0
      ignore_errors: true
      become: true
      #become_method: sudo
      become_user: root

- hosts: Vagrant
  gather_facts: True
  remote_user: root

  #vars:
  
  tasks:
    - name: Update package cache
      package:
        update_cache: yes
    - name: Upgrade packages
      command: apt-get upgrade -y
    - name: Update all packages to latest version
      package:
        upgrade: dist
    - name: Remove dependencies no longer needed
      package:
        autoremove: yes
